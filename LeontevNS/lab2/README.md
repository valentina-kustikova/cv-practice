# Практическая работа №2. Детектирование объектов на изображениях с использованием библиотеки OpenCV

## Используемые алгоритмы детектирования

### Алгоритм NanoDet
- **Высокая скорость** работы.
- Предобработка заключается в стандартизации данных, используя заданные mean и std.
- Постобработка заключается в использовании NMS, преобразований типа SoftMax и преобразований bounding boxes к виду:
[x1, y1, x2, y2]

### Алгоритм YOLOX
- **Высокая точность** детектирования объектов, но средняя скорость работы.
- Предобработка заключается в переводе в формат NCHW, если изначально на вход подаётся HWC.
- Постобработка заключается в использовании NMS Batched, преобразований bounding boxes к виду:
[x1, y1, width, height]

## Программная реализация

### Структура классов:

- **NanoDet** - реализация алгоритма NanoDet с постобработкой предсказаний.
- **YoloX** - реализация алгоритма YOLOX с анкерными боксами.
- **TPRCalculator** - класс для расчета метрик качества детектирования.

### Основные модули:

- `script.py` - основной скрипт для запуска детектирования.
- `nanodet.py` - реализация NanoDet детектора.
- `yolox.py` - реализация YOLOX детектора.

### Ключевые функции:

**Предобработка изображений:**
- `letterbox()` - преобразование изображения для YOLOX (сохранение пропорций)
- `letterbox_nano()` - преобразование изображения для NanoDet (адаптивное масштабирование)

**Постобработка результатов:**
- `unletterbox()` - обратное преобразование координат для YOLOX.
- `unletterbox_nano()` - обратное преобразование координат для NanoDet.

**Визуализация:**
- `vis()` - отрисовка bounding boxes для YOLOX.
- `vis_nano()` - отрисовка bounding boxes для NanoDet.

**Оценка качества:**
- `get_tpr_on_frame()` - расчет True Positive Rate.
- `get_fdr_on_frame()` - расчет False Discovery Rate.

## Метрики оценки качества

### True Positive Rate (TPR)
- Показывает, какая доля реальных объектов была правильно детектирована:
- `TPR = True Positives / (True Positives + False Negatives)`

### False Discovery Rate (FDR)  
- Показывает, какая доля детекций является ложными срабатываниями:
- `FDR = False Positives / (True Positives + False Positives)`

### Intersection over Union (IoU)
- Метрика для оценки пересечения предсказанных и реальных bounding boxes.
- Используется для определения True Positives.

## Особенности реализации

### Оптимизации:
- **Пакетная обработка** изображений для увеличения производительности.
- **Асинхронное выполнение** для оптимизации работы с пакетом изображений.
- **Многопоточность** для визуализации результатов пакета параллельно с запуском инференса следующего.

## Параметры запуска

### Основные параметры:
- `--backend_target` - выбор аппаратного ускорения (0-4)
- `--input` - путь к папке с изображениями
- `--confidence` - порог уверенности для детекций (по умолчанию: 0.5)
- `--nms` - порог Non-Maximum Suppression (по умолчанию: 0.6)
- `--obj` - порог объекта для YOLOX (по умолчанию: 0.5)

### Дополнительные параметры:
- `--nano` - использование NanoDet (иначе YOLOX)
- `--batch` - размер пакета для обработки (по умолчанию: 50)
- `--threshold` - порог IoU для оценки качества (по умолчанию: 0.5)
- `--start` - начальный кадр для обработки

## Выходные данные

### Визуализация:
- Bounding boxes с классами объектов и их вероятностями
- Цветовая кодировка классов (синий - автомобили, красный - автобусы, зеленый - другие)
- FPS визуализации зависит от скорости инференса

### Метрики качества:
- **TPR** для видео из задания:
- Nanodet: 46.189%
- YoloX: 88.441%
- **FDR** для видео из задания:
- Nanodet: 44.163%
- YoloX: 25.780%
- **Время инференса** для каждого пакета
- **500 изображений:**
- Nanodet: 45 секунд
- YoloX: 146 секунд

