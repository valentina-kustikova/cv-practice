# Практическая работа №3. Классификация изображений с использованием библиотеки OpenCV

**Выполнил:** Ануфриев Даниил  
**Группа:** 3822Б1ПМОП3

В работе реализована система классификации изображений достопримечательностей Нижнего Новгорода:
1.  Нижегородский Кремль (NizhnyNovgorodKremlin)
2.  Архангельский собор (ArkhangelskCathedral)
3.  Дворец труда (PalaceOfLabor)

Использованы два подхода:
*   **BoVW (Bag of Visual Words):** Классический метод компьютерного зрения (детекторы SIFT/ORB + KMeans + SVM).
*   **CNN (Convolutional Neural Network):** Глубокое обучение с использованием Transfer Learning (ResNet18).

---

## Описание реализации

### Структура проекта
*   `models/bovw_model.py` — Реализация метода «Мешок слов». Используется `MiniBatchKMeans` для кластеризации дескрипторов и `SVM` для классификации. Поддерживаются детекторы SIFT и ORB.
*   `models/cnn_model.py` — Реализация нейросети на PyTorch. Используется предобученная модель ResNet18, у которой заменен последний полносвязный слой под 3 класса.
*   `utils/dataset_loader.py` — Загрузка данных. Реализовано **случайное перемешивание (shuffling)** списка файлов перед разделением на train/test для обеспечения равномерного распределения классов.
*   `utils/metrics.py` — Расчет метрик (Accuracy, Precision, Recall, F1) и построение матрицы ошибок.
*   `train.py` — Основной скрипт запуска.

### Данные
Всего 131 изображение. Разбиение 80% / 20% с перемешиванием.
*   **Train:** 104 изображения.
*   **Test:** 27 изображений.

---

## Результаты экспериментов

### 1. Нейросеть (CNN: ResNet18)
*   **Параметры:** `epochs=5`, `batch_size=16`, `lr=1e-4`
*   **Accuracy:** **0.9630 (96.30%)**

Модель показала наилучший результат, допустив всего одну ошибку (один раз спутала Кремль с Собором).

**Confusion Matrix:**
```
                      Kremlin  Cathedral    Palace
Kremlin      13                        1                        0
Cathedral       0                        4                        0
Palace       0                        0                        9
```

### 2. Мешок слов (BoVW + ORB)
*   **Параметры:** `clusters=100`, `nfeatures=500`
*   **Accuracy:** **0.8519 (85.19%)**

Детектор ORB показал неожиданно высокий результат для классического метода, корректно классифицировав большинство объектов. Основные ошибки возникли при распознавании Собора и Дворца.

**Confusion Matrix:**
```
                      Kremlin  Cathedral    Palace
Kremlin      14                        0                        0
Cathedral       0                        2                        2
Palace       2                        0                        7
```

### 3. Мешок слов (BoVW + SIFT)
*   **Параметры:** `clusters=100`, `nfeatures=500`
*   **Accuracy:** 0.7778 (77.78%)

Метод SIFT показал достойную точность, но в данном эксперименте уступил ORB и нейросети. Ошибки распределены равномерно между классами.

**Confusion Matrix:**
```
                      Kremlin  Cathedral    Palace
Kremlin      13                        1                        0
Cathedral       1                        2                        1
Palace       1                        2                        6
```

---

## Итоговое сравнение

| Метод | BoVW + SIFT | BoVW + ORB | CNN: ResNet18 |
| :--- | :--- | :--- | :--- |
| **Параметры** | clusters=100 | clusters=100 | epochs=5 |
| **Accuracy** | 0.7778 | 0.8519 | **0.9630** |

### Вывод
1.  **Нейросетевой подход (ResNet18)** является безусловным лидером с точностью **96.3%**. Transfer Learning позволяет модели уверенно различать архитектурные стили даже на малой выборке.
2.  **Важность подготовки данных:** Внедрение случайного перемешивания (shuffling) данных перед разделением на выборки позволило поднять точность классических методов с ~7% (при неудачном разбиении) до **78-85%**.
3.  **Сравнение детекторов:** В данном эксперименте бинарный дескриптор **ORB (85.2%)** превзошел **SIFT (77.8%)**. Это может быть связано с особенностями тестовой выборки (контрастность, освещение), где ORB нашел более устойчивые признаки.