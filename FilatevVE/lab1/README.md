# Практическая работа №1. Обработка изображений с использованием библиотеки OpenCV

## Описание проекта

Данный проект представляет собой библиотеку фильтров для обработки изображений, реализованную с использованием базовых операций OpenCV. Проект включает интерактивное приложение с графическим интерфейсом для демонстрации работы всех фильтров.

## Структура проекта

```
lab1/
├── main.py                 # Основной файл приложения
├── lib/
│   ├── change_images.py    # Реализация всех фильтров
│   ├── manager_change.py   # Менеджеры для интерактивного управления фильтрами
│   └── manager_window.py   # Класс для управления окном OpenCV
├── images/                 # Папка с тестовыми изображениями
├── frames/                 # Папка с фигурными рамками
├── texture/                # Папка с текстурами для эффектов
└── requirements.txt        # Зависимости проекта
```

## Реализованные фильтры

### 1. Функция изменения разрешения изображения
**Файл:** `lib/manager_window.py` (метод `add_image_with_padding`)

**Алгоритм:**
- Вычисляется соотношение сторон окна и изображения
- Определяется новый размер изображения с сохранением пропорций
- Изображение масштабируется
- Добавляются черные полосы для заполнения пустого пространства

### 2. Функция применения фотоэффекта сепии к изображению
**Файл:** `lib/change_images.py` (функция `sepia_filter`)

**Алгоритм:**
- Применяется матрица преобразования цветов сепии:
  ```
  [0.393, 0.769, 0.189]
  [0.349, 0.686, 0.168]
  [0.272, 0.534, 0.131]
  ```
- Интенсивность эффекта регулируется линейной интерполяцией между матрицей сепии и единичной матрицей
- Используется функция `cv2.transform()` для применения матричного преобразования
- Результат обрезается до диапазона [0, 255]

### 3. Функция применения фотоэффекта виньетки к изображению
**Файл:** `lib/change_images.py` (функция `apply_vignette_elliptical`)

**Алгоритм:**
- Создается гауссово ядро для генерации эллиптической маски
- Используются функции `cv2.getGaussianKernel()` для создания одномерных ядер
- Двумерное ядро формируется как произведение одномерных ядер
- Маска нормализуется и применяется к изображению с заданной интенсивностью
- Результат обрезается до диапазона [0, 255]

### 4. Функция пикселизации заданной прямоугольной области изображения
**Файл:** `lib/change_images.py` (функция `pixelate_region`)

**Алгоритм:**
- Выделяется прямоугольная область изображения по заданным координатам
- Область уменьшается до размера `(w//pixel_size, h//pixel_size)` с использованием линейной интерполяции
- Уменьшенная область увеличивается обратно до исходного размера
- Обработанная область вставляется обратно в исходное изображение

### 5. Функция наложения прямоугольной одноцветной рамки заданной ширины по краям изображения
**Файл:** `lib/change_images.py` (функция `add_rectangular_border`)

**Алгоритм:**
- Определяется ширина рамки (по умолчанию 1/10 от минимального размера изображения)
- Пиксели верхней и нижней границ устанавливаются в заданный цвет
- Пиксели левой и правой границ устанавливаются в заданный цвет
- Операция выполняется путем прямого присваивания значений массиву изображения

### 6. Функция наложения фигурной одноцветной рамки по краям изображения
**Файл:** `lib/change_images.py` (функция `apply_figure_frame`)

**Алгоритм:**
- Загружается изображение рамки с альфа-каналом из папки `frames/`
- Рамка масштабируется до размера исходного изображения
- Извлекаются RGB-компоненты и альфа-канал рамки
- Применяется альфа-блендинг: `result = image * (1 - alpha) + frame * alpha`
- Результат возвращается как новое изображение

### 7. Функция наложения эффекта бликов объектива камеры
**Файл:** `lib/change_images.py` (функция `add_lens_flare`)

**Алгоритм:**
- Загружается текстура блика из файла `texture/flare_texture.jpg`
- Текстура масштабируется на основе параметра `flare_size`
- Определяется позиция блика в нормализованных координатах и конвертируется в пиксельные координаты
- Вычисляются границы области наложения текстуры с учетом границ изображения
- Текстура накладывается на изображение путем аддитивного смешивания: `image += texture * intensity`
- Результат обрезается до диапазона [0, 255]

### 8. Функция наложения текстуры акварельной бумаги
**Файл:** `lib/change_images.py` (функция `add_watercolor_texture`)

**Алгоритм:**
- Загружается текстура из файла `texture/water_paper.jpg`
- Текстура масштабируется до размера исходного изображения, если необходимо
- Создается маска текстуры: `mask = 1 - (texture_gray / 255.0)`
- Маска корректируется на основе параметра `strength`
- Результат обрезается до диапазона [0, 255]

## Управление программой

### Основные команды
- `a` - предыдущее изображение
- `d` - следующее изображение
- `i` - показать информацию о текущем изображении
- `Esc` - выход из программы

### Применение фильтров
- `1` - Фотоэффект сепия
- `2` - Фотоэффект виньетка
- `3` - Пикселизация области
- `4` - Прямоугольная рамка
- `5` - Фигурная рамка
- `6` - Эффект бликов
- `7` - Текстура акварельной бумаги

### Интерактивное управление фильтрами

#### Сепия
- Колесико мыши - изменение интенсивности эффекта

#### Виньетка
- Колесико мыши - изменение размера виньетки
- `W`/`S` - увеличение/уменьшение интенсивности

#### Пикселизация
- Мышь - выбор области для пикселизации
- `W`/`S` - изменение размера пикселя
- `Enter` - подтверждение выбора

#### Прямоугольная рамка
- Колесико мыши - изменение цвета
- Правая кнопка мыши - выбор цветового канала
- `W`/`S` - изменение толщины рамки

#### Фигурная рамка
- `W`/`S` - переключение между доступными рамками

#### Эффект бликов
- Колесико мыши - изменение интенсивности
- Левая кнопка мыши - выбор позиции блика
- `W`/`S` - изменение размера блика

#### Текстура акварельной бумаги
- Колесико мыши - изменение интенсивности текстуры
- `W`/`S` - изменение силы применения текстуры
