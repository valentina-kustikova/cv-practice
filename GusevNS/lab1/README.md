# Практическая работа №1. Обработка изображений с использованием библиотеки OpenCV

## Структура проекта

- `script.py` - основной скрипт с реализацией всех фильтров
- `README.md` - описание алгоритмов и инструкции по использованию
- `textures/` - папка с текстурами
  - `glare.jpg` - текстура блика
  - `watercolor_paper.jpg` - текстура акварельной бумаги
  - `frame0.jpg`, `frame1.jpg`, `frame2.jpg`, `frame3.jpg`, `frame4.jpg` - текстуры декоративных рамок

## Реализованные функции

### 1. Функция изменения разрешения изображения (`resize_image`)

**Алгоритм:**
- Создаются координатные сетки для нового изображения
- Вычисляются соответствующие координаты в исходном изображении
- Используется векторизованная интерполяция ближайшего соседа
- Применяется `np.meshgrid` для создания сеток координат

**Параметры:**
- `image` - исходное изображение
- `width` - новая ширина
- `height` - новая высота

### 2. Функция применения фотоэффекта сепии (`sepia_filter`)

**Алгоритм:**
- Применяется матрица преобразования цветов для создания сепия-эффекта
- Матрица преобразования:
  ```
  [0.272, 0.349, 0.393]
  [0.534, 0.686, 0.769]
  [0.131, 0.168, 0.189]
  ```
- Используется матричное умножение: `image @ sepia_matrix`
- Результат ограничивается диапазоном [0, 255] с помощью `np.clip`

**Параметры:**
- `image` - исходное изображение

### 3. Функция применения фотоэффекта виньетки (`vignette_filter`)

**Алгоритм:**
- Вычисляется центр изображения
- Создаются координатные сетки с помощью `np.ogrid`
- Вычисляется матрица расстояний от центра до каждого пикселя
- Создается маска виньетки: `1 - (distance / max_distance) * strength`
- Маска применяется к изображению путем умножения

**Параметры:**
- `image` - исходное изображение
- `strength` - сила эффекта виньетки (0-1, по умолчанию 0.5)

### 4. Функция пикселизации заданной области (`pixelate_region`)

**Алгоритм:**
- Извлекается прямоугольная область из изображения
- Область уменьшается в `pixel_size` раз с помощью функции `resize_image`
- Уменьшенная область возвращается к исходному размеру
- Обработанная область заменяется в исходном изображении

**Параметры:**
- `image` - исходное изображение
- `x, y` - координаты левого верхнего угла области
- `width, height` - размеры области
- `pixel_size` - размер пикселя для пикселизации (по умолчанию 10)

### 4.1. Функция интерактивной пикселизации области (`interactive_pixelate`)

**Алгоритм:**
- Создается окно с изображением и устанавливается callback функция для обработки событий мыши
- При нажатии левой кнопки мыши фиксируется начальная точка выделения
- При движении мыши с зажатой кнопкой обновляется конечная точка выделения
- При отпускании кнопки применяется пикселизация к выбранной области с помощью `pixelate_region`
- Визуально отображается прямоугольник выделения
- Выход из режима выбора по нажатию ESC

**Параметры:**
- `image` - исходное изображение
- `pixel_size` - размер пикселя для пикселизации (по умолчанию 15)

### 5. Функция наложения прямоугольной рамки (`add_rectangular_frame`)

**Алгоритм:**
- Создается копия исходного изображения
- С помощью срезов заполняются верхняя, нижняя, левая и правая полосы заданным цветом
- Используется векторизованное присваивание

**Параметры:**
- `image` - исходное изображение
- `frame_width` - ширина рамки
- `color` - цвет рамки в формате BGR (по умолчанию черный)

### 6. Функция наложения фигурной рамки (`add_decorative_frame`)

**Алгоритм:**
- Загружается текстура рамки из файла `textures/frame{N}.jpg` в зависимости от типа с поддержкой альфа-канала
- Текстура масштабируется под размер изображения с помощью `resize_image`
- Если текстура содержит альфа-канал, используется альфа-смешивание для наложения
- Если альфа-канала нет, создается маска на основе цветового различия от белого фона (порог > 30)
- Рамка накладывается на изображение с учетом альфа-канала или маски

**Параметры:**
- `image` - исходное изображение
- `frame_type` - тип рамки ("wavy", "pattern", "straight", "red", "floral")
- `frame_width` - ширина рамки (не используется, оставлено для совместимости)
- `color` - цвет рамки в формате BGR (не используется, оставлено для совместимости)

### 7. Функция наложения эффекта бликов (`add_lens_flare`)

**Алгоритм:**
- Загружается текстура блика из файла `textures/glare.jpg` с поддержкой альфа-канала
- Текстура масштабируется до 1/4 размера изображения
- Вычисляются координаты размещения блика с учетом границ изображения
- Если текстура содержит альфа-канал, используется альфа-смешивание для наложения
- Если альфа-канала нет, блик добавляется к изображению с заданной интенсивностью
- Результат ограничивается диапазоном [0, 255]

**Параметры:**
- `image` - исходное изображение
- `flare_x, flare_y` - координаты центра блика
- `intensity` - интенсивность блика (0-1, по умолчанию 0.8)

### 8. Функция наложения текстуры акварельной бумаги (`add_watercolor_texture`)

**Алгоритм:**
- Загружается текстура акварельной бумаги из файла `textures/watercolor_paper.jpg` с поддержкой альфа-канала
- Текстура масштабируется под размер изображения с помощью `resize_image`
- Если текстура содержит альфа-канал, используется альфа-смешивание с учетом силы эффекта
- Если альфа-канала нет, создается маска на основе яркости текстуры (инвертированная нормализованная яркость)
- Изображение смешивается с текстурой с учетом маски и силы эффекта

**Параметры:**
- `image` - исходное изображение
- `texture_strength` - сила текстуры (0-1, по умолчанию 0.3)

## Использование

### Запуск скрипта

```bash
python script.py -i <путь_к_изображению> -f <тип_фильтра> [дополнительные_параметры]
```

### Примеры использования

1. **Изменение разрешения:**
```bash
python script.py -i image.jpg -f resize --width 800 --height 600
```

2. **Эффект сепии:**
```bash
python script.py -i image.jpg -f sepia
```

3. **Эффект виньетки:**
```bash
python script.py -i image.jpg -f vignette --strength 0.7
```

4. **Пикселизация области:**
```bash
python script.py -i image.jpg -f pixelate --x 100 --y 100 --pixel_size 15
```

5. **Прямоугольная рамка:**
```bash
python script.py -i image.jpg -f frame --frame_width 30
```

6. **Декоративная рамка:**
```bash
python script.py -i image.jpg -f decorative_frame --frame_type wavy --frame_width 25
```

7. **Эффект бликов:**
```bash
python script.py -i image.jpg -f flare --flare_x 400 --flare_y 300 --strength 0.8
```

8. **Текстура акварельной бумаги:**
```bash
python script.py -i image.jpg -f watercolor --strength 0.4
```

### Параметры командной строки

- `-i, --image` - путь к исходному изображению (обязательный)
- `-f, --filter` - тип фильтра (обязательный)
- `-o, --output` - имя выходного файла (по умолчанию: output.jpg)
- `--width, --height` - размеры для изменения разрешения
- `--strength` - сила эффекта для виньетки, бликов и текстуры
- `--x, --y` - координаты для пикселизации
- `--pixel_size` - размер пикселя для пикселизации
- `--frame_width` - ширина рамки
- `--frame_type` - тип декоративной рамки
- `--flare_x, --flare_y` - координаты центра блика

## Автор

Гусев Никита
