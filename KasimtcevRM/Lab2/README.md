# Практическая работа №2. Детектирование объектов на изображениях с использованием библиотеки OpenCV

## Описание программы

В данной работе представлена реализация приложения для детектирования объектов на изображении или видео с использованием обученной
нейронной сети YOLOv4.

## Описание параметров запуска программы

При запуске через командную строку могут быть указаны следующие параметры:

- `--mode (-m)`: Режим работы (изображение `Image`, видео `Video`).
- `--input (-i)`: Путь к входному изображению или видео.
- `--output (-o)`: Путь к файлу для записи полученных результатов.
- `--config (-c)`: Путь к файлу конфигурации модели.
- `--weights (-w)`: Путь к файлу весов модели.
- `--labels (-l)`: Путь к файлу меток классов.
- `--conf_threshold (-ct)`: Пороговая вероятность.
- `--nms_threshold (-nt)`: Пороговое перекрытие окаймляющих прямоугольников.

## Реализованные алгоритмы

### Функция 'Process_Image'

В данной функции происходит преобразование входного изображения к стандартному виду, с которым может работать выбранная модель.
Непосредственно за счет метода "cv.dnn.blobFromImage" происходят:
- Нормализация значений изображения - из каждого вектора значений сначала вычитается среднее значение (0,0,0) и каждый элемент приводится в нужный диапазон (через домножение на 1/255).
- Изменение размера изображения до заданного (608х608) по средством маштабирования.
- Преобразование в формат blop, для работы с нейронными сетями.

### Функция 'Process_Output'

После подачи изображения в модель, генерируется выход, состоящий из множества обнаружений, каждое из которых включает следующие последовательно расположенные элементы:
- Описание detection box для данного предсказания в виде 4 значений: нормированные координаты центра, нормированная ширина, нормировванная высота. Домножив значения на ширину или высоту изображения, можно получить настоящие значения.
- Описание вероятности принадлежности объекта внутри detection box к одному из классов в виде вектора из 80 значений.

Полученный вывод преобразуется, и каждое обнаружение приводится к иному описанию:
- Наибольшая вероятность принадлежности к классу.
- Номер класса с наибольшей вероятностью.
- Координаты левой верхней вершины, ширина и высота окаймляющего прямоугольника.

### Функция 'Detect_Image

Исходный вывод сети может содержать несколько окаймляющих прямоугольников одного и того же объекта,поэтому в данной функции с помощью метода  cv.'dnn.NMSBoxes' производится удаление лишних прямоугольников по принципу:
- Удаляются обнаружения, вероятность которых ниже пороговой вероятности.
- Сравниваются все окаймляющие прямоугольники, и среди тех, перекрытие которых выше порогового, выбирается та, вероятность которой наибольшая, а остальные удаляются.
- В результате повторного выполнения до момента, пока не останется окаймляющих прямоугольников, перекрытие которых выше порогового, остаются только уникальные рамки для каждого объекта.

### Отображение результатов

После выполнения указанных выше действий в классе 'Visualisator' на исходное изображение или видео накладываются соответствующие окаймляющие прямоугольники, с подписями, указывающими на предсказанный класс и вероятность принадлежности к нему. Цвета прямоугольников и надписей одинаковы среди одного класса, и для простоты выбираются случайно.