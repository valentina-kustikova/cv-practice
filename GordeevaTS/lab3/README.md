# Лабораторная работа №3. Классификация изображений с использованием библиотеки OpenCV

## Постановка задачи

**Цель работы** — разработать приложение для классификации изображений достопримечательностей Нижнего Новгорода и сравнить два подхода:
 - Метод «мешка визуальных слов» (Bag of Visual Words)
 - Нейросетевой подход с извлечением признаков и классическими ML-алгоритмами

**Классы для классификации:**
 - Нижегородский Кремль
 - Дворец труда
 - Архангельский собор


## Методы, их преимущества и недостатки
**Bag of Visual Words**

Метод "Мешка визуальных слов" представляет собой классический подход компьютерного зрения, основанный на аналогии с 
текстовым анализом. Сначала алгоритм SIFT находит на изображениях ключевые точки: углы и характерные области, 
устойчивые к изменениям масштаба и поворота. Для каждой точки вычисляется числовой дескриптор, описывающий её окружение. 
Все дескрипторы со всех изображений группируются в кластеры методом K-means, создавая "визуальный словарь". Каждое 
изображение затем преобразуется в гистограмму, показывающую частоту использования каждого "слова" из словаря. Эти 
гистограммы служат основой для обучения SVM-классификатора.

*Преимущества:*
 - Инвариантность к масштабу и повороту
 - Хорошая интерпретируемость
 - Не требует GPU
 - Эффективен на небольших датасетах

*Недостатки:*
 - Не учитывает пространственные связи
 - Требует ручного выбора детектора
 - Меньшая точность по сравнению с глубокими сетями
 - Чувствительность к качеству детектирования признаков


**Transfer Learning с ResNet50**

Этот подход использует предобученную сверточную нейронную сеть ResNet50, обученную на наборе данных ImageNet. Архитектура ResNet с остаточными связями позволяет эффективно обучать очень глубокие сети. В данном решении используется техника transfer learning: базовые слои ResNet50 замораживаются, а последний полносвязный слой заменяется на новый, адаптированный под нашу задачу классификации 3 классов. Это позволяет использовать мощные признаки, извлеченные на большом датасете, и дообучить модель на наших данных.

*Преимущества:*
 - Автоматическое извлечение высокоуровневых признаков
 - Высокая точность (благодаря предобучению)
 - Современное качество классификации

*Недостатки:*
 - Меньшая интерпретируемость
 - Зависимость от качества предобученной модели


## Архитектура решения
### 1) BoW (Bag of Words - Мешок слов)

**Этапы работы:**
1. Детектирование ключевых точек: SIFT-детекторы
2. Извлечение дескрипторов: 128-мерные векторы признаков
3. Построение словаря: K-means кластеризация
4. Векторизация: гистограммы визуальных слов
5. Классификация: SVM с линейным ядром

### 2) NN (Transfer Learning с ResNet50)

**Этапы работы:**
1. Предобработка изображений: resize до 256px, center crop 224px, нормализация ImageNet
2. Загрузка предобученной ResNet50 с весами IMAGENET1K_V1
3. Заморозка всех слоев кроме последнего полносвязного
4. Замена выходного слоя на 3 нейрона
5. Обучение только последнего слоя

## Использование программы
**Базовые параметры:**
 - `--data_path`: Путь к директории с данными
 - `--train_split`: Файл с тренировочной выборкой
 - `--test_split`: Файл с тестовой выборкой
 - `--algorithm {bow|nn}`: Выбор алгоритма
 - `--mode {train|test|both}`: Режим работы
 - `--model_path`: Путь для сохранения/загрузки моделей
 - `--model_name`: Конкретное имя модели для загрузки


**Запуск Bag of Words:**
```
# Обучение и тестирование с визуализацией ключевых точек
python main.py --data_path ./data --train_split data/train.txt --test_split data/test.txt --algorithm bow --detector SIFT --vocab_size 50 --visualize_keypoints --max_keypoints 100

# Только тестирование последней модели
python main.py --data_path ./data --train_split data/train.txt --test_split data/test.txt --algorithm bow --mode test

# Тестирование конкретной модели
python main.py --data_path ./data --train_split data/train.txt --test_split data/test.txt --algorithm bow --mode test --model_name bow_SIFT_vocab50_20251119_002702
```

**Запуск нейросетевого классификатора:**
```
# Обучение и тестирование
python main.py --data_path ./data --train_split data/train.txt --test_split data/test.txt --algorithm nn --epochs 15 --batch_size 32

# Только тестирование последней модели
python main.py --data_path ./data --train_split data/train.txt --test_split data/test.txt --algorithm nn --mode test

# Тестирование конкретной модели
python main.py --data_path ./data --train_split data/train.txt --test_split data/test.txt --algorithm nn --mode test --model_name nn_resnet_20251119_002702
```

## Сравнение методов
|Метод|Точность|
|---|---|
|Bag of Visual Words |**0.9659**|
|Transfer Learning (CNN)|**0.9886**|


## Выводы и результаты
**В ходе работы было выполнено следующее:**
 - Реализован метод мешка визуальных слов для классификации изображений
 - Реализован нейросетевой подход с transfer learning на основе ResNet50
 - Реализована визуализация ключевых точек для BOW метода
 - Проведено сравнение эффективности методов

**Основные выводы**
 - Transfer Learning демонстрирует более высокую точность благодаря использованию предобученных признаков
 - BOW метод показывает хорошие результаты и обеспечивает лучшую интерпретируемость за счет визуализации ключевых точек
 - Оба подхода эффективны для задачи классификации архитектурных объектов
