# Практическая работа №3. Классификация изображений с использованием библиотеки OpenCV

## Описание проекта

Разработано приложение для классификации изображений достопримечательностей Нижнего Новгорода:
- Нижегородский Кремль (kremlin)
- Дворец труда (palace)
- Архангельский собор (cathedral)

## Реализованные алгоритмы

### 1. Алгоритм "Мешок слов" (Bag of Words)

**Особенности реализации:**
- Поддержка различных детекторов: SIFT, ORB
- Кластеризация методом MiniBatchKMeans для построения визуального словаря
- Классификация с помощью SVM (Support Vector Machine)
- Визуализация ключевых точек для отладки

**Архитектура BOW:**
1. Детектирование ключевых точек с использованием SIFT/ORB детекторов
2. Извлечение дескрипторов для каждого изображения
3. Построение визуального словаря методом кластеризации K-means
4. Преобразование изображений в гистограммы визуальных слов
5. Обучение классификатора на полученных признаках

### 2. Нейросетевой классификатор

**Особенности реализации:**
- Transfer learning на основе предобученной MobileNetV2
- Data augmentation для увеличения разнообразия тренировочных данных
- Early stopping и динамическое уменьшение learning rate
- Автоматическая предобработка изображений

**Архитектура нейронной сети:**
- Базовая модель: MobileNetV2 (предобученная на ImageNet)
- Дополнительные слои: GlobalAveragePooling2D, Dropout, Dense, BatchNormalization
- Выходной слой: Softmax с 3 нейронами (по количеству классов)

## Результаты тестирования

### Сравнительный анализ алгоритмов

| Метрика                   | Нейронная сеть | Bag of Words |
|---------------------------|----------------|--------------|
| **Accuracy**              | 100%           | 89.77%       |
| **Precision (макро)**     | 1.00           | 0.91         |
| **Recall (макро)**        | 1.00           | 0.86         |
| **F1-score (макро)**      | 1.00           | 0.87         |
| **Время обучения**        | Дольше         | Быстрее      |
| **Требования к ресурсам** | Выше           | Ниже         |

### Детальные результаты по классам

#### Нейронная сеть (MobileNetV2 + Transfer Learning)

| Класс            | Precision | Recall | F1-score | Support |
|------------------|-----------|--------|----------|---------|
| cathedral        | 1.00      | 1.00   | 1.00     | 20      |
| kremlin          | 1.00      | 1.00   | 1.00     | 39      |
| palace           | 1.00      | 1.00   | 1.00     | 29      |
| **Accuracy**     |           |        | 1.00     | 88      |
| **Macro Avg**    | 1.00      | 1.00   | 1.00     | 88      |
| **Weighted Avg** | 1.00      | 1.00   | 1.00     | 88      |

#### Алгоритм "Мешок слов" (BOW + SIFT + SVM)

| Класс            | Precision | Recall | F1-score | Support |
|------------------|-----------|--------|----------|---------|
| cathedral        | 0.92      | 0.60   | 0.73     | 20      |
| kremlin          | 0.87      | 1.00   | 0.93     | 39      |
| palace           | 0.93      | 0.97   | 0.95     | 29      |
| **Accuracy**     |           |        | 0.90     | 88      |
| **Macro Avg**    | 0.91      | 0.86   | 0.87     | 88      |
| **Weighted Avg** | 0.90      | 0.90   | 0.89     | 88      |

## Структура проекта
### Файлы исходного кода
```
project/
├── main.py # Основной скрипт приложения
├── bow_classifier.py # Реализация алгоритма "Мешок слов"
├── nn_classifier.py # Реализация нейросетевого классификатора
├── utils.py # Вспомогательные функции
├── fix_labels.py # Скрипт для подготовки данных
└── requirements.txt # Список зависимостей
```
### Структура данных
```
data/
├── train_fixed.txt # Исправленная тренировочная выборка
├── test_fixed.txt # Исправленная тестовая выборка
├── NNSUDataset/ # Фотографии студентов
│ ├── 01_NizhnyNovgorodKremlin/
│ ├── 04_ArkhangelskCathedral/
│ └── 08_PalaceOfLabor/
└── ExtDataset/ # Фотографии из сети Интернет
├── 01_NizhnyNovgorodKremlin/
├── 04_ArkhangelskCathedral/
└── 08_PalaceOfLabor/
```

## Установка и запуск

### Установка зависимостей

```bash
pip install opencv-python == 4.8.1.78
pip install scikit-learn == 1.3.0
pip install tensorflow == 2.13.0
pip install numpy == 1.24.3
pip install matplotlib == 3.7.2
```

### Подготовка данных
```bash
python fix_labels.py
```

## Запуск
### Нейронная сеть
```bash
python main.py --data_dir ./data --train_split ./data/train_fixed.txt --test_split ./data/test_fixed.txt --mode both --algorithm nn --epochs 20 --batch_size 16 --model_path nn_model.pkl
```
### Мешок слов
```bash
python main.py --data_dir ./data --train_split ./data/train_fixed.txt --test_split ./data/test_fixed.txt --mode both --algorithm bow --vocab_size 1000 --detector SIFT --model_path bow_model.pkl
```

## Параметры командной строки

### Основные параметры

| Параметр        | Обязательный | Тип    | Значения по умолчанию | Допустимые значения     | Описание                            |
|-----------------|--------------|--------|-----------------------|-------------------------|-------------------------------------|
| `--data_dir`    | Да           | string | -                     | Любой существующий путь | Путь к директории с данными         |
| `--train_split` | Да           | string | -                     | Любой существующий файл | Файл с тренировочной выборкой       |
| `--test_split`  | Да           | string | -                     | Любой существующий файл | Файл с тестовой выборкой            |
| `--mode`        | Да           | string | -                     | `train`, `test`, `both` | Режим работы приложения             |
| `--algorithm`   | Да           | string | -                     | `bow`, `nn`             | Используемый алгоритм классификации |
| `--model_path`  | Нет          | string | `model.pkl`           | Любой корректный путь   | Путь для сохранения/загрузки модели |

### Параметры для алгоритма "Мешок слов"

| Параметр       | Обязательный | Тип    | Значения по умолчанию | Допустимые значения | Описание                   |
|----------------|--------------|--------|-----------------------|---------------------|----------------------------|
| `--vocab_size` | Нет          | int    | `1000`                | 100-5000            | Размер визуального словаря |
| `--detector`   | Нет          | string | `SIFT`                | `SIFT`, `ORB`       | Детектор особенностей      |

### Параметры для нейронной сети

| Параметр       | Обязательный | Тип | Значения по умолчанию | Допустимые значения | Описание                  |
|----------------|--------------|-----|-----------------------|---------------------|---------------------------|
| `--epochs`     | Нет          | int | `50`                  | 10-200              | Количество эпох обучения  |
| `--batch_size` | Нет          | int | `32`                  | 8-64                | Размер батча для обучения |