# Практическая работа №2. Детектирование объектов на изображениях с использованием библиотеки OpenCV

# 1. Описание используемых моделей

В работе реализовано три детектора, каждый из которых наследует общий базовый класс `BaseDetector`, реализует собственные методы предобработки и постобработки, и интегрирован в фабрику моделей.

---

## 1.1 SSD MobileNet V2  
Источник: https://github.com/chuanqi305/MobileNet-SSD

### Предобработка
- Изменение размера входа до **300×300**
- Формирование blob: `cv2.dnn.blobFromImage`

### Постобработка
- Преобразование нормализованных координат в пиксели исходного кадра
- Фильтрация слабых детекций по confidence
- Обрезка прямоугольников по границам кадра
- Применение `cv2.dnn.NMSBoxes` отдельно для каждого класса
---

## 1.2 YOLOv4-tiny  
Источник: https://github.com/Neloy262/YOLO-V4

### Предобработка
- Размер входа **608×608**
- Нормализация ×(1/255)
- RGB перестановка
- Формирование blob через `cv2.dnn.blobFromImage`

### Постобработка
- Восстановление центров и размеров объектов
- Преобразование в формат углов прямоугольника `(x_min, y_min, x_max, y_max)`
- Фильтрация по confidence
- Применение `cv2.dnn.NMSBoxes` отдельно для каждого класса 

---

## 1.3 Faster R-CNN ResNet50  
Источник: https://storage.googleapis.com/download.tensorflow.org/models/object_detection/faster_rcnn_resnet50_coco_2018_01_28.tar.gz

### Предобработка
- Размер входа **300×300**
- Формирование blob: `cv2.dnn.blobFromImage`

### Постобработка
- Преобразование нормализованных координат в пиксели исходного кадра
- Фильтрация слабых детекций по confidence
- Обрезка прямоугольников по границам кадра
- Применение `cv2.dnn.NMSBoxes` отдельно для каждого класса

---

# 2. Метрики качества

## 2.1 Матрица ошибок

|               | Предсказывает: объект | Предсказывает: фон |
|---------------|------------------------|---------------------|
| **Есть объект** | TP (True Positive)     | FN (False Negative) |
| **Нет объекта** | FP (False Positive)    | TN (True Negative)  |

### Обозначения:
- **TP** — модель правильно нашла объект  
- **FP** — модель нашла объект там, где его нет  
- **FN** — объект есть, но модель его пропустила  
- **TN** — модель правильно определила, что объекта нет

---

## 2.2 Формулы метрик

### TPR (Recall) — полнота
$$
TPR = \frac{TP}{TP + FN}
$$

### FDR (False Discovery Rate) — доля ложных находок
$$
FDR = \frac{FP}{TP + FP}
$$

---

## 2.3 IoU — Intersection over Union
$$
IoU = \frac{Area(Intersection)}{Area(Union)}
$$

---

# 3. Сравнение результатов моделей

| Модель | TPR | FDR | TP | FP | FN |
|--------|----------|----------|---------|---------|---------|
| **SSD MobileNet V2** | 0.7297 | **0.0571** | 14807 | 897 | 5485 |
| **YOLOv4-tiny** | **0.7914** | 0.0918 | 16059 | 1623 | 4233 |
| **Faster R-CNN ResNet-50** | 0.7793 | 0.0930 | 15814 | 1621 | 4478 |

---

# 4. Пример запуска приложения

```bash
python main.py --images data/imgs_MOV03478 --ann data/mov03478.txt --model yolo_v4_coco --show
```
