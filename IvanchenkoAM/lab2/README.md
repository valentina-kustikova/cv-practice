# Практическая работа №2. Детектирование объектов на изображениях с использованием библиотеки OpenCV

## Описание проекта

Проект реализует задачу обнаружения объектов на изображениях или видео с использованием предобученной модели YOLO. YOLO — это эффективный алгоритм для детекции объектов, который обрабатывает изображение за один проход через нейронную сеть, что позволяет быстро и точно находить объекты на изображениях.

## Реализованные алгоритмы

### 1. Предобработка изображения (BlobFromImage)

Перед тем как подать изображение в модель YOLO, оно проходит этап **предобработки**:

- **Изменение размера**: Изображение масштабируется до фиксированного размера 416x416 пикселей, что соответствует стандартному размеру входа для модели YOLOv3.
- **Нормализация**: Каждый пиксель изображения нормализуется путем вычитания средних значений (в данном случае `(0, 0, 0)`) и деления на стандартное отклонение (значение `0.00392` для YOLO). Это позволяет сети работать с изображением в стандартизированном виде.
- **Преобразование в Blob**: После изменения размера и нормализации изображение преобразуется в формат "blob" с использованием функции `cv.dnn.blobFromImage`. Этот blob передается в нейронную сеть для дальнейшей обработки.

### 2. Обработка выхода сети

После подачи изображения в модель YOLO, сеть генерирует выход, состоящий из множества предсказаний, каждое из которых включает:

- **Координаты объекта**: Каждое предсказание содержит координаты прямоугольной рамки вокруг объекта (x, y, ширина, высота).
- **Уверенность (confidence)**: Вероятность того, что объект действительно присутствует в данной области.
- **Класс объекта**: Идентификатор класса объекта, который был распознан (например, "car", "person", "traffic light").

### 3. Постобработка (NMS)

Чтобы уменьшить количество дублирующихся рамок для одного объекта, используется алгоритм **Не максимальная подавление (Non-Maximum Suppression, NMS)**. Этот алгоритм удаляет рамки, которые перекрывают другие рамки более чем на заданный порог (обычно 0.4), оставляя только ту, которая имеет наибольшую уверенность.

Процесс выглядит следующим образом:
- Все детекции с уверенностью выше заданного порога проходят в следующий этап.
- Алгоритм NMS сравнивает все прямоугольные рамки и, если две рамки для одного объекта сильно перекрываются, то одна из них удаляется.
- В результате остаются только уникальные рамки для каждого объекта.

### 4. Отображение результатов

После того как объекты были обнаружены и обработаны, на исходное изображение или видео накладываются прямоугольные рамки (bounding boxes) с подписями, которые указывают, какой объект был найден и с какой уверенностью. Рамки отображаются с использованием случайно выбранных цветов для каждого класса объекта.

### 5. Параметры конфигурации

Для настройки работы алгоритма через командную строку предусмотрены следующие параметры:

- **`--input` (-i)**: Путь к входному изображению или видео.
- **`--confidence_threshold` (-c)**: Порог уверенности для детекции объектов (значение от 0 до 1). Объекты с уверенностью ниже порога не будут отображаться.
- **`--nms_threshold` (-n)**: Порог для алгоритма не максимальной подавления (NMS). Определяет, насколько сильно рамки могут перекрывать друг друга.
- **`--input_size` (-s)**: Размер входного изображения, который будет подаваться в модель. Стандартный размер для YOLO — 416x416 пикселей.
- **`--weights` (-w)**: Путь к файлу весов YOLO.
- **`--config` (-cf)**: Путь к файлу конфигурации YOLO.
- **`--names` (-nms)**: Путь к файлу имен классов.

## Пример использования

1. Для обработки изображения:
   ```bash
   python main.py -i test.jpg -w yolov3.weights -cfg yolov3.cfg -names coco.names -c 0.5 -n 0.4 -s 416 416
2. Для обработки видео:
   ```bash
   python main.py -i test.mp4 -w yolov3.weights -cfg yolov3.cfg -names coco.names -c 0.5 -n 0.4 -s 416 416
3. Для обработки файла со стандартными параметрами:
   ```bash
   python main.py -i test.jpg -w yolov3.weights -cfg yolov3.cfg -names coco.names
4. Для просмотра доступных параметров:
   ```bash
   python main.py --help
